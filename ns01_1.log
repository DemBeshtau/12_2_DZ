[vagrant@ns01 ~]$ sudo -i

[root@ns01 ~]# setenforce 0            
 
[root@ns01 ~]# getenforce
Enforcing

[root@ns01 ~]# setenforce 0

[root@ns01 ~]# getenforce
Permissive

[root@ns01 ~]# echo > /var/log/audit/audit.log 

[root@ns01 ~]# cat /var/log/audit/audit.log 

[root@ns01 ~]# audit2why < /var/log/audit/audit.log
type=AVC msg=audit(1717612588.365:752): avc:  denied  { create } for  pid=879 comm="isc-worker0000" name="named.ddns.lab.view1.jnl" scontext=system_u:system_r:named_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=file

	Was caused by:
		Missing type enforcement (TE) allow rule.

		You can use audit2allow to generate a loadable module to allow this access.

type=AVC msg=audit(1717612588.365:752): avc:  denied  { write } for  pid=879 comm="isc-worker0000" path="/etc/named/dynamic/named.ddns.lab.view1.jnl" dev="dm-0" ino=100834444 scontext=system_u:system_r:named_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=file

	Was caused by:
		Missing type enforcement (TE) allow rule.

		You can use audit2allow to generate a loadable module to allow this access.

[root@ns01 ~]# sealert -a /var/log/audit/audit.log | grep ""

found 1 alerts in /var/log/audit/audit.log
--------------------------------------------------------------------------------

SELinux –∑–∞–ø—Ä–µ—â–∞–µ—Ç /usr/sbin/named –¥–æ—Å—Ç—É–ø create –∫ —Ñ–∞–π–ª named.ddns.lab.view1.jnl.

*****  –ú–æ–¥—É–ª—å catchall_labels –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç (—Ç–æ—á–Ω–æ—Å—Ç—å 83.8)  ********************

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å named –∏–º–µ—Ç—å create –¥–æ—Å—Ç—É–ø –∫ named.ddns.lab.view1.jnl $TARGET_–£–ß–ï–ë–ù–´–ô –ö–õ–ê–°–°
–¢–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑–º–µ–Ω–∏—Ç—å –º–µ—Ç–∫—É –Ω–∞ named.ddns.lab.view1.jnl
–°–¥–µ–ª–∞—Ç—å
# semanage fcontext -a -t FILE_TYPE 'named.ddns.lab.view1.jnl'
–≥–¥–µ FILE_TYPE –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è: dnssec_trigger_var_run_t, ipa_var_lib_t, krb5_host_rcache_t, krb5_keytab_t, named_cache_t, named_log_t, named_tmp_t, named_var_run_t, named_zone_t. 
–ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: 
restorecon -v 'named.ddns.lab.view1.jnl'


*****  –ú–æ–¥—É–ª—å catchall –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç (—Ç–æ—á–Ω–æ—Å—Ç—å 17.1)  ***************************

–ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ named –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–æ create –¥–æ—Å—Ç—É–ø –∫ named.ddns.lab.view1.jnl file –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
–¢–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ.
–ß—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –ø–æ–ª–∏—Ç–∏–∫–∏.
–°–¥–µ–ª–∞—Ç—å
allow this access for now by executing:
# ausearch -c 'isc-worker0000' --raw | audit2allow -M my-iscworker0000
# semodule -i my-iscworker0000.pp


–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è:
–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç             system_u:system_r:named_t:s0
–¶–µ–ª–µ–≤–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç              system_u:object_r:etc_t:s0
–¶–µ–ª–µ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã               named.ddns.lab.view1.jnl [ file ]
–ò—Å—Ç–æ—á–Ω–∏–∫                      isc-worker0000
–ü—É—Ç—å –∫ –∏—Å—Ç–æ—á–Ω–∏–∫—É              /usr/sbin/named
–ü–æ—Ä—Ç                          <Unknown>
–£–∑–µ–ª                          <Unknown>
–ò—Å—Ö–æ–¥–Ω—ã–µ –ø–∞–∫–µ—Ç—ã RPM           bind-9.11.4-26.P2.el7_9.15.x86_64
–¶–µ–ª–µ–≤—ã–µ –ø–∞–∫–µ—Ç—ã RPM            
–ü–∞–∫–µ—Ç —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞              selinux-policy-3.13.1-192.el7_5.3.noarch
SELinux –∞–∫—Ç–∏–≤–µ–Ω               True
–¢–∏–ø —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∞                targeted
–†–µ–∂–∏–º                         Permissive
–ò–º—è —É–∑–ª–∞                      ns01
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞                     Linux ns01 3.10.0-862.2.3.el7.x86_64 #1 SMP Wed
                              May 9 18:05:47 UTC 2018 x86_64 x86_64
–°—á–µ—Ç—á–∏–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π           1
–í–ø–µ—Ä–≤—ã–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ            2024-06-05 18:36:28 UTC
–í –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑               2024-06-05 18:36:28 UTC
–õ–æ–∫–∞–ª—å–Ω—ã–π ID                  f4cca6b2-1761-439a-9392-f25ce2173afb

–ü–æ—Å—Ç—Ä–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π –∞—É–¥–∏—Ç–∞
type=AVC msg=audit(1717612588.365:752): avc:  denied  { create } for  pid=879 comm="isc-worker0000" name="named.ddns.lab.view1.jnl" scontext=system_u:system_r:named_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=file


type=AVC msg=audit(1717612588.365:752): avc:  denied  { write } for  pid=879 comm="isc-worker0000" path="/etc/named/dynamic/named.ddns.lab.view1.jnl" dev="dm-0" ino=100834444 scontext=system_u:system_r:named_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=file


type=SYSCALL msg=audit(1717612588.365:752): arch=x86_64 syscall=open success=yes exit=ENXIO a0=7f8c946d4050 a1=241 a2=1b6 a3=24 items=0 ppid=1 pid=879 auid=4294967295 uid=25 gid=25 euid=25 suid=25 fsuid=25 egid=25 sgid=25 fsgid=25 tty=(none) ses=4294967295 comm=isc-worker0000 exe=/usr/sbin/named subj=system_u:system_r:named_t:s0 key=(null)

Hash: isc-worker0000,named_t,etc_t,file,create

[root@ns01 ~]# cat /var/log/audit/audit.log 

type=AVC msg=audit(1717612588.365:752): avc:  denied  { create } for  pid=879 comm="isc-worker0000" name="named.ddns.lab.view1.jnl" scontext=system_u:system_r:named_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=file
type=AVC msg=audit(1717612588.365:752): avc:  denied  { write } for  pid=879 comm="isc-worker0000" path="/etc/named/dynamic/named.ddns.lab.view1.jnl" dev="dm-0" ino=100834444 scontext=system_u:system_r:named_t:s0 tcontext=system_u:object_r:etc_t:s0 tclass=file
type=SYSCALL msg=audit(1717612588.365:752): arch=c000003e syscall=2 success=yes exit=6 a0=7f8c946d4050 a1=241 a2=1b6 a3=24 items=0 ppid=1 pid=879 auid=4294967295 uid=25 gid=25 euid=25 suid=25 fsuid=25 egid=25 sgid=25 fsgid=25 tty=(none) ses=4294967295 comm="isc-worker0000" exe="/usr/sbin/named" subj=system_u:system_r:named_t:s0 key=(null)
type=PROCTITLE msg=audit(1717612588.365:752): proctitle=2F7573722F7362696E2F6E616D6564002D75006E616D6564002D63002F6574632F6E616D65642E636F6E66
]0;root@ns01:~[root@ns01 ~]# ausearch -c 'isc-worker0000' --raw | audit2allow -M my-iscworker0000
******************** IMPORTANT ***********************
To make this policy package active, execute:

semodule -i my-iscworker0000.pp

[root@ns01 ~]# semodule -i my-iscworker0000.pp

[root@ns01 ~]# setenforce 1

[root@ns01 ~]# getenforce
Enforcing

[root@ns01 ~]# ll
total 24
-rw-------. 1 root root 5763 May 12  2018 anaconda-ks.cfg
-rw-r--r--. 1 root root  973 Jun  5 18:49 my-iscworker0000.pp
-rw-r--r--. 1 root root  251 Jun  5 18:49 my-iscworker0000.te
-rw-------. 1 root root 5432 May 12  2018 original-ks.cfg

[root@ns01 ~]# cat my-iscworker0000.te

module my-iscworker0000 1.0;

require {
	type etc_t;
	type named_t;
	class file { create rename unlink write };
}

#============= named_t ==============

#!!!! WARNING: 'etc_t' is a base type.
allow named_t etc_t:file { create rename unlink write };

[root@ns01 ~]# reboot

dem@calculate ~/vagrant/12_2_DZ $ vagrant ssh ns01

Last login: Wed Jun  5 17:51:21 2024 from 10.0.2.2

[vagrant@ns01 ~]$ exit
logout
dem@calculate ~/vagrant/12_2_DZ $ exit

exit

